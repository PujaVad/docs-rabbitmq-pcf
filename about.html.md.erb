---
title: On-Demand Service Architecture
owner: London Services
---

This topic describes the architecture for on-demand RabbitMQ&reg; for Pivotal Cloud Foundry (PCF).

For information about architecture of the older, pre-provisioned service, see [Deploying the RabbitMQÂ® Service](./deploying.html).

## <a id="service-network"></a>Service Network Requirement

<%= partial '../../rabbitmq-cf/odb/service-networks-v3' %>

## <a id='on-demand'></a>Default Network and Service Network

<%= partial '../../rabbitmq-cf/odb/on_demand_architecture' %>


## <a id="network-rules"></a> Required Networking Rules for On-Demand Services

<%= partial '../../rabbitmq-cf/odb/service_networks_table' %>

<br>
Regardless of the specific network layout, the operator must ensure network
rules are set up so that connections are open as described in the table below.

<table class="nice">
	<th>Source VM</th>
	<th>Destination VM</th>
	<th>Default TCP Port</th>
	<th>Notes</th>
	<tr>
		<td><strong>ODB</strong></td>
		<td>
		    <ul>
		        <li><strong>BOSH Director</strong></li>
		    	<li><strong>BOSH UAA</strong></li>
		    </ul>
		</td>
		<td>
			<ul>
				<li>25555</li>
				<li>8443</li>
			</ul>
		</td>
		<td>The default ports are not configurable.</td>
	</tr>
	<tr>
		<td><strong>ODB</strong></td>
		<td><strong>Deployed service instances</strong>
		</td>
		<td>15672 (RabbitMQ Management UI)</td>
		<td>This connection is for administrative tasks.
			Avoid opening general use, app-specific ports for this connection.</td>
	</tr>
	<tr>
		<td><strong>ODB</strong></td>
		<td><strong>PAS</strong>
		</td>
		<td>8443</td>
		<td>The default port is not configurable.</td>
	</tr>
	<tr>
		<td><strong>Errand VMs</strong></td>
		<td>
			<ul>
				<li><strong>PAS</strong></li>
				<li><strong>ODB</strong></li>
				<li><strong>Deployed Service Instances</strong></li>
			</ul>
		</td>
		<td>
			<ul>
				<li>8443</li>
				<li>8080</li>
				<li>15672 (RabbitMQ Management UI)</li>
				<li>5671-2 (AMQP/AMQPS)</li>
			</ul>
		</td>
		<td>The default port is not configurable.</td>
	</tr>
	<tr>
		<td><strong>BOSH Agent</strong></td>
		<td><strong>BOSH Director</strong>
		</td>
		<td>4222</td>
		<td>The BOSH Agent runs on every VM in the system, including the BOSH Director VM.
			The BOSH Agent initiates the connection with the BOSH Director.<br>
			The default port is not configurable.<br><br>
			The communication between these VMs is two-way.</td>
	</tr>
	<tr>
		<td><strong>Deployed apps on PAS</strong></td>
		<td><strong>Deployed service instances</strong>
		</td>
		<td>
			<ul>
				<li>15672 (RabbitMQ Management UI)</li>
				<li>5671-2 (AMQP/AMQPS)</li>
				<li>61613-4 (STOMP/STOMPS)</li>
				<li>1883, 8883 (MQTT/MQTTS)</li>
		</td>
		<td>This connection is for general use, app-specific tasks.
			Avoid opening administrative ports for this connection.</td>
	</tr>
	<tr>
		<td><strong>PAS</strong></td>
		<td><strong>ODB</strong>
		</td>
		<td>8080</td>
		<td>This port may be different for individual services.
			This port may also be configurable by the operator if allowed by the
			tile developer.</td>
	</tr>
		<tr>
		<td><strong>Deployed apps on PAS</strong></td>
		<td><strong>Runtime CredHub</strong>
		</td>
		<td>8844</td>
		<td>This port is needed if secure service instance credentials are enabled.<br>
			For information, see <a href="install-config.html#credhub">(Beta) On Demand - Secure Service Instance Credentials with Runtime CredHub</a>.</td>
	</tr>
</table>
